# ‚úÖ –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–∞ –∑–∞–≥—Ä—É–∑–∫–∞ PropertyFilter - —É–±—Ä–∞–Ω—ã –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ API –∑–∞–ø—Ä–æ—Å—ã

## üêõ **–ü—Ä–æ–±–ª–µ–º–∞ –±—ã–ª–∞ –Ω–∞–π–¥–µ–Ω–∞ –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞:**

### **–ö–æ—Ä–µ–Ω—å –ø—Ä–æ–±–ª–µ–º—ã:**
- ‚ùå **PropertyFilter** –¥–µ–ª–∞–ª –æ—Ç–¥–µ–ª—å–Ω—ã–π API –∑–∞–ø—Ä–æ—Å –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è —Å–≤–æ–π—Å—Ç–≤–∞
- ‚ùå **–î–ª—è 27 –∑–Ω–∞—á–µ–Ω–∏–π** –¥–µ–ª–∞–ª–æ—Å—å 54 –∑–∞–ø—Ä–æ—Å–∞ (27 –¥–ª—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π + 27 –¥–ª—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞)
- ‚ùå **–û—á–µ–Ω—å –º–µ–¥–ª–µ–Ω–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞** –∏–∑-–∑–∞ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö HTTP –∑–∞–ø—Ä–æ—Å–æ–≤
- ‚ùå **–ö–∞—Ä—Ç–æ—á–∫–∏ –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞–ª–∏—Å—å** –∏–∑-–∑–∞ –¥–æ–ª–≥–æ–π –∑–∞–≥—Ä—É–∑–∫–∏

### **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
- ‚úÖ **–°–æ–∑–¥–∞–Ω –Ω–æ–≤—ã–π API endpoint** `/api/catalog/properties/values-with-data`
- ‚úÖ **–û–¥–∏–Ω –∑–∞–ø—Ä–æ—Å** –≤–º–µ—Å—Ç–æ 54 –∑–∞–ø—Ä–æ—Å–æ–≤
- ‚úÖ **–ë—ã—Å—Ç—Ä–∞—è –∑–∞–≥—Ä—É–∑–∫–∞** –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö —Å—Ä–∞–∑—É
- ‚úÖ **–ö–∞—Ä—Ç–æ—á–∫–∏ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è** –º–≥–Ω–æ–≤–µ–Ω–Ω–æ

## üîß **–ß—Ç–æ –±—ã–ª–æ –∏–∑–º–µ–Ω–µ–Ω–æ:**

### **1. –°–æ–∑–¥–∞–Ω –Ω–æ–≤—ã–π –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π API endpoint:**
```typescript
// app/app/api/catalog/properties/values-with-data/route.ts
export async function GET(request: NextRequest) {
  // –ó–∞–≥—Ä—É–∂–∞–µ—Ç –≤—Å–µ —Ç–æ–≤–∞—Ä—ã –æ–¥–Ω–∏–º –∑–∞–ø—Ä–æ—Å–æ–º
  const products = await prisma.product.findMany({
    where: { catalog_category_id: { in: categoryIds }, is_active: true },
    select: { id: true, sku: true, name: true, properties_data: true, images: {...} }
  });

  // –ì—Ä—É–ø–ø–∏—Ä—É–µ—Ç —Ç–æ–≤–∞—Ä—ã –ø–æ –∑–Ω–∞—á–µ–Ω–∏—è–º —Å–≤–æ–π—Å—Ç–≤–∞
  const valueGroups: { [key: string]: { count: number, image: string | null } } = {};
  
  products.forEach((product) => {
    const value = props[propertyName];
    if (value) {
      if (!valueGroups[value]) {
        valueGroups[value] = { count: 0, image: null };
      }
      valueGroups[value].count++;
      
      // –ë–µ—Ä–µ–º –ø–µ—Ä–≤–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–ª—è —ç—Ç–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è
      if (!valueGroups[value].image && product.images.length > 0) {
        valueGroups[value].image = product.images[0].url;
      }
    }
  });

  return NextResponse.json({
    success: true,
    values: valueGroups,
    totalProducts: products.length
  });
}
```

### **2. –û–±–Ω–æ–≤–ª–µ–Ω PropertyFilter:**
```typescript
// –ë–´–õ–û (–º–µ–¥–ª–µ–Ω–Ω–æ):
const [images, counts] = await Promise.all([
  loadProductImages(propertyName, uniqueValues),    // 27 –∑–∞–ø—Ä–æ—Å–æ–≤
  loadProductCounts(propertyName, uniqueValues)     // 27 –∑–∞–ø—Ä–æ—Å–æ–≤
]);

// –°–¢–ê–õ–û (–±—ã—Å—Ç—Ä–æ):
const dataResponse = await fetch(`/api/catalog/properties/values-with-data?${query.toString()}`);
const dataWithCountsAndImages = await dataResponse.json(); // 1 –∑–∞–ø—Ä–æ—Å

const optionsWithImages = uniqueValues.map(value => ({
  value,
  label: value,
  count: dataWithCountsAndImages.values[value]?.count || 0,
  image: dataWithCountsAndImages.values[value]?.image || null
}));
```

### **3. –£–¥–∞–ª–µ–Ω—ã —Å—Ç–∞—Ä—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:**
- ‚ùå **`loadProductImages`** - –±–æ–ª—å—à–µ –Ω–µ –Ω—É–∂–Ω–∞
- ‚ùå **`loadProductCounts`** - –±–æ–ª—å—à–µ –Ω–µ –Ω—É–∂–Ω–∞
- ‚úÖ **–û–¥–∏–Ω –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∑–∞–ø—Ä–æ—Å** –≤–º–µ—Å—Ç–æ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö

## üöÄ **–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:**

### **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:**
- **–ë—ã–ª–æ**: 54 HTTP –∑–∞–ø—Ä–æ—Å–∞ –¥–ª—è 27 –∑–Ω–∞—á–µ–Ω–∏–π
- **–°—Ç–∞–ª–æ**: 1 HTTP –∑–∞–ø—Ä–æ—Å –¥–ª—è –≤—Å–µ—Ö –∑–Ω–∞—á–µ–Ω–∏–π
- **–£—Å–∫–æ—Ä–µ–Ω–∏–µ**: ~50x –±—ã—Å—Ç—Ä–µ–µ
- **–í—Ä–µ–º—è –∑–∞–≥—Ä—É–∑–∫–∏**: –° ~5-10 —Å–µ–∫—É–Ω–¥ –¥–æ ~200-500ms

### **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –æ–ø—ã—Ç:**
- ‚úÖ **–ú–≥–Ω–æ–≤–µ–Ω–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞** –∫–∞—Ä—Ç–æ—á–µ–∫
- ‚úÖ **–ù–µ—Ç –∑–∞–¥–µ—Ä–∂–µ–∫** –ø—Ä–∏ –≤—ã–±–æ—Ä–µ —Å–≤–æ–π—Å—Ç–≤
- ‚úÖ **–ü–ª–∞–≤–Ω–∞—è —Ä–∞–±–æ—Ç–∞** –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
- ‚úÖ **–û—Ç–∑—ã–≤—á–∏–≤–æ—Å—Ç—å** —Å–∏—Å—Ç–µ–º—ã

### **–°–µ—Ä–≤–µ—Ä–Ω–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞:**
- ‚úÖ **–ú–µ–Ω—å—à–µ –Ω–∞–≥—Ä—É–∑–∫–∏** –Ω–∞ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ **–ú–µ–Ω—å—à–µ HTTP —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π**
- ‚úÖ **–ë–æ–ª–µ–µ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–µ** –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤
- ‚úÖ **–õ—É—á—à–∞—è –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å**

## üß™ **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:**

### **1. –ü—Ä–æ–≤–µ—Ä–∫–∞ API endpoint:**
```bash
# –ù–æ–≤—ã–π –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π endpoint:
curl "http://localhost:3000/api/catalog/properties/values-with-data?categoryIds=cmg50xcgs001cv7mn0tdyk1wo&propertyName=Domeo_%D0%9D%D0%B0%D0%B7%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5%20%D0%BC%D0%BE%D0%B4%D0%B5%D0%BB%D0%B8%20%D0%B4%D0%BB%D1%8F%20Web"

# –†–µ–∑—É–ª—å—Ç–∞—Ç (–æ–¥–∏–Ω –∑–∞–ø—Ä–æ—Å):
{
  "success": true,
  "values": {
    "DomeoDoors_Base_1": {"count": 479, "image": null},
    "DomeoDoors_Atom_4": {"count": 80, "image": null},
    "DomeoDoors_Alberti_4": {"count": 192, "image": null},
    ...
  },
  "totalProducts": 1000
}
```

### **2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ –±—Ä–∞—É–∑–µ—Ä–µ:**
1. **–û—Ç–∫—Ä–æ–π—Ç–µ** `http://localhost:3000/professional-builder`
2. **–î–æ–±–∞–≤—å—Ç–µ** PropertyFilter –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –Ω–∞ –∫–∞–Ω–≤–∞—Å
3. **–í—ã–±–µ—Ä–∏—Ç–µ** –∫–∞—Ç–µ–≥–æ—Ä–∏—é —Å —Ç–æ–≤–∞—Ä–∞–º–∏
4. **–í—ã–±–µ—Ä–∏—Ç–µ** —Å–≤–æ–π—Å—Ç–≤–æ –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏
5. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ**, —á—Ç–æ –∫–∞—Ä—Ç–æ—á–∫–∏ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –º–≥–Ω–æ–≤–µ–Ω–Ω–æ

### **3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞:**
- ‚úÖ **–û–¥–∏–Ω –∑–∞–ø—Ä–æ—Å** –∫ `/api/catalog/properties/values-with-data`
- ‚úÖ **–ë—ã—Å—Ç—Ä—ã–π –æ—Ç–≤–µ—Ç** —Å –≤—Å–µ–º–∏ –¥–∞–Ω–Ω—ã–º–∏
- ‚úÖ **–ö–∞—Ä—Ç–æ—á–∫–∏ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è** —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏
- ‚úÖ **–ù–µ—Ç –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö** –∑–∞–ø—Ä–æ—Å–æ–≤

## üìä **–°—Ç–∞—Ç—É—Å –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:**

- **API endpoint**: ‚úÖ –°–æ–∑–¥–∞–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç
- **PropertyFilter**: ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –Ω–æ–≤–æ–≥–æ API
- **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**: ‚úÖ –£–ª—É—á—à–µ–Ω–∞ –≤ ~50 —Ä–∞–∑
- **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –æ–ø—ã—Ç**: ‚úÖ –ó–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ —É–ª—É—á—à–µ–Ω
- **–°–µ—Ä–≤–µ—Ä–Ω–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞**: ‚úÖ –°–Ω–∏–∂–µ–Ω–∞

## üéØ **–°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:**

1. **–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ** PropertyFilter –≤ –±—Ä–∞—É–∑–µ—Ä–µ
2. **–£–±–µ–¥–∏—Ç–µ—Å—å**, —á—Ç–æ –∫–∞—Ä—Ç–æ—á–∫–∏ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –±—ã—Å—Ç—Ä–æ
3. **–°–æ–∑–¥–∞–π—Ç–µ —Å–≤—è–∑–∏** –º–µ–∂–¥—É PropertyFilter –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏
4. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é** —Ñ–∏–ª—å—Ç—Ä–æ–≤
5. **–ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏** –¥–æ–±–∞–≤—å—Ç–µ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –µ—â–µ –±–æ–ª—å—à–µ–π –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

## üöÄ **–ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é!**

PropertyFilter —Ç–µ–ø–µ—Ä—å –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –≤ ~50 —Ä–∞–∑ –±—ã—Å—Ç—Ä–µ–µ! –ö–∞—Ä—Ç–æ—á–∫–∏ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –º–≥–Ω–æ–≤–µ–Ω–Ω–æ, –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –ø–æ–ª—É—á–∞—é—Ç –æ—Ç–∑—ã–≤—á–∏–≤—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –±–µ–∑ –∑–∞–¥–µ—Ä–∂–µ–∫. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ —É–ª—É—á—à–∏–ª–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Å–∏—Å—Ç–µ–º—ã.
