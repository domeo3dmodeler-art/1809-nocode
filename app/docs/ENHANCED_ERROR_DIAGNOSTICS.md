# üîç –£–ª—É—á—à–µ–Ω–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –æ—à–∏–±–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π

## ‚ùå **–¢–µ–∫—É—â–∞—è –ø—Ä–æ–±–ª–µ–º–∞:**
–ü—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–≤—è–∑–∫–∏ —Ñ–æ—Ç–æ –ø–æ—è–≤–ª—è–µ—Ç—Å—è –¥–µ—Ç–∞–ª—å–Ω–∞—è –æ—à–∏–±–∫–∞:
```
"–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π: –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π: –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏"
```

## ‚úÖ **–ß—Ç–æ –±—ã–ª–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏:**

### **1. –î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ API (`/api/admin/categories/[id]`):**

#### **–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∏:**
```typescript
console.log('–ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏:', categoryId);
console.log('–ö–∞—Ç–µ–≥–æ—Ä–∏—è –Ω–∞–π–¥–µ–Ω–∞:', {
  id: existingCategory.id,
  name: existingCategory.name,
  slug: existingCategory.slug,
  isActive: existingCategory.is_active
});
```

#### **–ë–µ–∑–æ–ø–∞—Å–Ω–∞—è —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è JSON:**
```typescript
if (photoMapping) {
  console.log('–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ photoMapping:', photoMapping);
  try {
    updateData.photo_mapping = JSON.stringify(photoMapping);
    console.log('photoMapping —É—Å–ø–µ—à–Ω–æ —Å–µ—Ä–∏–∞–ª–∏–∑–æ–≤–∞–Ω');
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–∏ photoMapping:', error);
    return NextResponse.json(
      { error: '–û—à–∏–±–∫–∞ —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö —Ñ–æ—Ç–æ-—Å–≤—è–∑–∫–∏' },
      { status: 400 }
    );
  }
}
```

#### **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ Prisma:**
```typescript
try {
  updatedCategory = await prisma.frontendCategory.update({
    where: { id: categoryId },
    data: updateData
  });
  console.log('–ö–∞—Ç–µ–≥–æ—Ä–∏—è —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∞:', updatedCategory.id);
} catch (prismaError) {
  console.error('–û—à–∏–±–∫–∞ Prisma –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏:', prismaError);
  return NextResponse.json(
    { error: `–û—à–∏–±–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö: ${prismaError.message}` },
    { status: 500 }
  );
}
```

### **2. –ü—Ä–æ–≤–µ—Ä–∫–∞ categoryId –≤ DataUpload:**

```typescript
console.log('handlePhotoMappingComplete –≤—ã–∑–≤–∞–Ω —Å categoryId:', categoryId);

if (!categoryId) {
  console.error('categoryId –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω! –ù–µ–ª—å–∑—è —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –¥–∞–Ω–Ω—ã–µ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π.');
  alert('–û—à–∏–±–∫–∞: ID –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω. –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –¥–∞–Ω–Ω—ã–µ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π.');
  return;
}
```

## üîç **–ö–∞–∫ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–±–ª–µ–º—É:**

### **1. –û—Ç–∫—Ä–æ–π—Ç–µ Developer Tools:**
```
F12 ‚Üí Console
```

### **2. –ü–æ–≤—Ç–æ—Ä–∏—Ç–µ –ø—Ä–æ—Ü–µ—Å—Å —Å–≤—è–∑–∫–∏ —Ñ–æ—Ç–æ:**
```
1. –ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–æ—Ç–æ
2. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ —Å–≤—è–∑–∫—É
3. –ù–∞–∂–º–∏—Ç–µ "–ó–∞–≤–µ—Ä—à–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫—É"
```

### **3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –≤ –∫–æ–Ω—Å–æ–ª–∏:**

#### **–£—Å–ø–µ—à–Ω—ã–π —Å–ª—É—á–∞–π:**
```
handlePhotoMappingComplete –≤—ã–∑–≤–∞–Ω —Å categoryId: clxxx
–û—Ç–ø—Ä–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π –Ω–∞ —Å–µ—Ä–≤–µ—Ä: { categoryId: "clxxx", photoMapping: {...}, photoData: {...} }
PUT /api/admin/categories/[id] - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏: { categoryId: "clxxx", hasPhotoMapping: true, hasPhotoData: true, photoMappingType: "object", photoDataType: "object" }
–ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏: clxxx
–ö–∞—Ç–µ–≥–æ—Ä–∏—è –Ω–∞–π–¥–µ–Ω–∞: { id: "clxxx", name: "–î–≤–µ—Ä–∏ —Ç–µ—Å—Ç", slug: "doors-test", isActive: true }
–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ photoMapping: { mappingType: "by_sku", photoFiles: [...], mappedPhotos: {...} }
photoMapping —É—Å–ø–µ—à–Ω–æ —Å–µ—Ä–∏–∞–ª–∏–∑–æ–≤–∞–Ω
–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ photoData: { totalCount: 26, files: ["photo1.jpg", "photo2.jpg", ...] }
photoData —É—Å–ø–µ—à–Ω–æ —Å–µ—Ä–∏–∞–ª–∏–∑–æ–≤–∞–Ω
–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤ –ë–î —Å –¥–∞–Ω–Ω—ã–º–∏: { photo_mapping: "{...}", photo_data: "{...}", updated_at: "2024-..." }
–ö–∞—Ç–µ–≥–æ—Ä–∏—è —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∞: clxxx
–î–∞–Ω–Ω—ã–µ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ –ë–î
```

#### **–û—à–∏–±–∫–∞ categoryId:**
```
handlePhotoMappingComplete –≤—ã–∑–≤–∞–Ω —Å categoryId: undefined
categoryId –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω! –ù–µ–ª—å–∑—è —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –¥–∞–Ω–Ω—ã–µ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π.
```

#### **–û—à–∏–±–∫–∞ —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–∏:**
```
–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ photoMapping: { mappingType: "by_sku", photoFiles: [...], mappedPhotos: {...} }
–û—à–∏–±–∫–∞ —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–∏ photoMapping: TypeError: Converting circular structure to JSON
```

#### **–û—à–∏–±–∫–∞ Prisma:**
```
–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤ –ë–î —Å –¥–∞–Ω–Ω—ã–º–∏: { photo_mapping: "{...}", photo_data: "{...}", updated_at: "2024-..." }
–û—à–∏–±–∫–∞ Prisma –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏: PrismaClientValidationError: Invalid value provided
```

#### **–û—à–∏–±–∫–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞:**
```
–ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏: clxxx
–ö–∞—Ç–µ–≥–æ—Ä–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞: clxxx
```

## üéØ **–í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã –æ—à–∏–±–∫–∏:**

### **1. categoryId –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω:**
```typescript
// –ï—Å–ª–∏ categoryId = undefined
if (!categoryId) {
  // –û—à–∏–±–∫–∞: ID –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω
}
```

### **2. –ö–∞—Ç–µ–≥–æ—Ä–∏—è –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ –ë–î:**
```sql
-- –ï—Å–ª–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏—è –±—ã–ª–∞ —É–¥–∞–ª–µ–Ω–∞ –∏–ª–∏ ID –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π
SELECT * FROM frontend_categories WHERE id = 'clxxx';
-- –†–µ–∑—É–ª—å—Ç–∞—Ç: –ø—É—Å—Ç–æ–π
```

### **3. –ü—Ä–æ–±–ª–µ–º—ã —Å JSON —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–µ–π:**
```typescript
// –ï—Å–ª–∏ photoMapping —Å–æ–¥–µ—Ä–∂–∏—Ç —Ü–∏–∫–ª–∏—á–µ—Å–∫–∏–µ —Å—Å—ã–ª–∫–∏
JSON.stringify(photoMapping); // TypeError: Converting circular structure to JSON
```

### **4. –ü—Ä–æ–±–ª–µ–º—ã —Å Prisma:**
```typescript
// –ï—Å–ª–∏ –¥–∞–Ω–Ω—ã–µ –Ω–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç —Å—Ö–µ–º–µ –ë–î
await prisma.frontendCategory.update({
  where: { id: categoryId },
  data: updateData // –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
});
```

### **5. –ü—Ä–æ–±–ª–µ–º—ã —Å —Ñ–∞–π–ª–∞–º–∏:**
```typescript
// –ï—Å–ª–∏ —Ñ–∞–π–ª—ã –Ω–µ –∏–º–µ—é—Ç —Å–≤–æ–π—Å—Ç–≤–∞ name
photoData.files.map(f => f.name); // TypeError: Cannot read property 'name' of undefined
```

## üöÄ **–°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:**

### **1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –≤ –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞:**
- –û—Ç–∫—Ä–æ–π—Ç–µ Developer Tools (F12)
- –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ –≤–∫–ª–∞–¥–∫—É Console
- –ü–æ–≤—Ç–æ—Ä–∏—Ç–µ –ø—Ä–æ—Ü–µ—Å—Å —Å–≤—è–∑–∫–∏ —Ñ–æ—Ç–æ
- –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –≤—Å–µ –ª–æ–≥–∏

### **2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞:**
- –û—Ç–∫—Ä–æ–π—Ç–µ —Ç–µ—Ä–º–∏–Ω–∞–ª –≥–¥–µ –∑–∞–ø—É—â–µ–Ω Next.js
- –ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –ª–æ–≥–∏ –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ –∑–∞–ø—Ä–æ—Å–∞
- –ù–∞–π–¥–∏—Ç–µ –æ—à–∏–±–∫–∏ Prisma –∏–ª–∏ JSON

### **3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–∞–Ω–Ω—ã–µ:**
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ `categoryId` –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ –ë–î
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—Å–µ —Ñ–∞–π–ª—ã –∏–º–µ—é—Ç —Å–≤–æ–π—Å—Ç–≤–æ `name`
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ `mapping` –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç —Ü–∏–∫–ª–∏—á–µ—Å–∫–∏—Ö —Å—Å—ã–ª–æ–∫

## üí° **–ë—ã—Å—Ç—Ä—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**

### **1. –ï—Å–ª–∏ categoryId undefined:**
```typescript
// –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–µ—Ä–µ–¥–∞—á—É categoryId –≤ CategoryBuilder
<DataUpload
  categoryId={categoryData?.id} // –î–æ–ª–∂–Ω–æ –±—ã—Ç—å –Ω–µ undefined
  onPriceListLoaded={handlePriceListLoaded}
  onPhotosLoaded={handlePhotosLoaded}
  onComplete={handleDataComplete}
/>
```

### **2. –ï—Å–ª–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞:**
```sql
-- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –≤ –ë–î
SELECT id, name, slug FROM frontend_categories WHERE id = 'your-category-id';
```

### **3. –ï—Å–ª–∏ –æ—à–∏–±–∫–∞ JSON:**
```typescript
// –î–æ–±–∞–≤—å—Ç–µ –ø—Ä–æ–≤–µ—Ä–∫—É –Ω–∞ —Ü–∏–∫–ª–∏—á–µ—Å–∫–∏–µ —Å—Å—ã–ª–∫–∏
const safePhotoMapping = JSON.parse(JSON.stringify(mapping));
```

## üéâ **–†–µ–∑—É–ª—å—Ç–∞—Ç:**

**–î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–ª–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –¥–ª—è –≤—ã—è–≤–ª–µ–Ω–∏—è —Ç–æ—á–Ω–æ–π –ø—Ä–∏—á–∏–Ω—ã –æ—à–∏–±–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π!**

- ‚úÖ **–ü—Ä–æ–≤–µ—Ä–∫–∞ categoryId** - –≤–∏–¥–Ω–æ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω –ª–∏ ID –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
- ‚úÖ **–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∏** - –≤–∏–¥–Ω–æ –Ω–∞–π–¥–µ–Ω–∞ –ª–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏—è –≤ –ë–î
- ‚úÖ **–ë–µ–∑–æ–ø–∞—Å–Ω–∞—è —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è JSON** - –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–∏
- ‚úÖ **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ Prisma** - –¥–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö –ë–î
- ‚úÖ **–î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** - –ø–æ–ª–Ω–∞—è —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∞ –ø—Ä–æ—Ü–µ—Å—Å–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è

**–¢–µ–ø–µ—Ä—å –ø—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –æ—à–∏–±–∫–∏ –≤—ã —É–≤–∏–¥–∏—Ç–µ —Ç–æ—á–Ω—É—é –ø—Ä–∏—á–∏–Ω—É –≤ –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞!** üîç‚ú®




