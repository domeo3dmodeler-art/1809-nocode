# üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã —Å —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–µ–π photoFiles

## ‚ùå **–ü—Ä–æ–±–ª–µ–º–∞:**
–ü—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π –≤–æ–∑–Ω–∏–∫–∞–ª–∞ –æ—à–∏–±–∫–∞:
```
"–û—à–∏–±–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö: Invalid `prisma.frontendCategory.update()` invocation"
```

**–ü—Ä–∏—á–∏–Ω–∞:** –í `photoMapping.photoFiles` –ø–µ—Ä–µ–¥–∞–≤–∞–ª–∏—Å—å –ø—É—Å—Ç—ã–µ –æ–±—ä–µ–∫—Ç—ã `[{},{},{},...]` –≤–º–µ—Å—Ç–æ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –æ —Ñ–∞–π–ª–∞—Ö. –≠—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏–ª–æ –ø–æ—Ç–æ–º—É, —á—Ç–æ –æ–±—ä–µ–∫—Ç—ã `File` –Ω–µ –º–æ–≥—É—Ç –±—ã—Ç—å —Å–µ—Ä–∏–∞–ª–∏–∑–æ–≤–∞–Ω—ã –≤ JSON, –∏ –ø—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ –∏—Ö —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –ø–æ–ª—É—á–∞–ª–∏—Å—å –ø—É—Å—Ç—ã–µ –æ–±—ä–µ–∫—Ç—ã.

## üîç **–î–µ—Ç–∞–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã:**

### **1. –ß—Ç–æ –ø–µ—Ä–µ–¥–∞–≤–∞–ª–æ—Å—å –≤ API:**
```json
{
  "photoMapping": {
    "mappingType": "by_sku",
    "photoFiles": [{},{},{},{},{},{},...], // ‚ùå –ü—É—Å—Ç—ã–µ –æ–±—ä–µ–∫—Ç—ã
    "mappedPhotos": {
      "d5": "blob:http://localhost:3000/9060192a-7f46-49be-8371-6c5b5e5b997b",
      "d15": "blob:http://localhost:3000/042bcb33-b886-403a-b2cb-545be6db5e14",
      // ...
    }
  }
}
```

### **2. –ü–æ—á–µ–º—É —ç—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏–ª–æ:**
```typescript
// –í PhotoUploader.tsx
const [mapping, setMapping] = useState<PhotoMapping>({
  mappingType: 'by_sku',
  photoFiles: [], // –°–æ–¥–µ—Ä–∂–∏—Ç –æ–±—ä–µ–∫—Ç—ã File
  mappedPhotos: {}
});

// –ü—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Ñ–∞–π–ª–æ–≤
const handleFileUpload = (e: React.ChangeEvent<HTMLInputElement>) => {
  const files = Array.from(e.target.files || []);
  setMapping(prev => ({ ...prev, photoFiles: files })); // files —Å–æ–¥–µ—Ä–∂–∏—Ç File –æ–±—ä–µ–∫—Ç—ã
};
```

### **3. –ü—Ä–æ–±–ª–µ–º–∞ —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–∏:**
```typescript
// File –æ–±—ä–µ–∫—Ç—ã –Ω–µ –º–æ–≥—É—Ç –±—ã—Ç—å —Å–µ—Ä–∏–∞–ª–∏–∑–æ–≤–∞–Ω—ã –≤ JSON
JSON.stringify(new File([''], 'test.jpg')); // –†–µ–∑—É–ª—å—Ç–∞—Ç: {}
```

## ‚úÖ **–ß—Ç–æ –±—ã–ª–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:**

### **1. –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è –≤ DataUpload.tsx:**

#### **–î–û (–ø—Ä–æ–±–ª–µ–º–Ω—ã–π –∫–æ–¥):**
```typescript
const requestBody = {
  photoMapping: mapping, // mapping —Å–æ–¥–µ—Ä–∂–∏—Ç File –æ–±—ä–µ–∫—Ç—ã
  photoData: {
    totalCount: photoData.totalCount,
    files: photoData.files.map(f => f.name)
  }
};
```

#### **–ü–û–°–õ–ï (–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π –∫–æ–¥):**
```typescript
// –°–æ–∑–¥–∞–µ–º –±–µ–∑–æ–ø–∞—Å–Ω—É—é –≤–µ—Ä—Å–∏—é photoMapping –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏
const safePhotoMapping = {
  mappingType: mapping.mappingType,
  photoFiles: mapping.photoFiles.map(f => ({
    name: f.name,
    size: f.size,
    type: f.type,
    lastModified: f.lastModified
  })), // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º File –æ–±—ä–µ–∫—Ç—ã –≤ –ø—Ä–æ—Å—Ç—ã–µ –æ–±—ä–µ–∫—Ç—ã
  mappedPhotos: mapping.mappedPhotos
};

const requestBody = {
  photoMapping: safePhotoMapping,
  photoData: {
    totalCount: photoData.totalCount,
    files: photoData.files.map(f => f.name)
  }
};
```

### **2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ API:**

#### **–î–æ–±–∞–≤–ª–µ–Ω–∞ –≤–∞–ª–∏–¥–∞—Ü–∏—è –≤ `/api/admin/categories/[id]/route.ts`:**
```typescript
if (photoMapping) {
  console.log('–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ photoMapping:', photoMapping);
  
  // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ photoFiles –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –ø—É—Å—Ç—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤
  if (photoMapping.photoFiles && Array.isArray(photoMapping.photoFiles)) {
    const hasEmptyObjects = photoMapping.photoFiles.some((file: any) => 
      typeof file === 'object' && Object.keys(file).length === 0
    );
    
    if (hasEmptyObjects) {
      console.error('–û–±–Ω–∞—Ä—É–∂–µ–Ω—ã –ø—É—Å—Ç—ã–µ –æ–±—ä–µ–∫—Ç—ã –≤ photoFiles:', photoMapping.photoFiles);
      return NextResponse.json(
        { error: '–û–±–Ω–∞—Ä—É–∂–µ–Ω—ã –ø—É—Å—Ç—ã–µ –æ–±—ä–µ–∫—Ç—ã –≤ –¥–∞–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π' },
        { status: 400 }
      );
    }
  }
  
  try {
    updateData.photo_mapping = JSON.stringify(photoMapping);
    console.log('photoMapping —É—Å–ø–µ—à–Ω–æ —Å–µ—Ä–∏–∞–ª–∏–∑–æ–≤–∞–Ω');
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–∏ photoMapping:', error);
    return NextResponse.json(
      { error: '–û—à–∏–±–∫–∞ —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö —Ñ–æ—Ç–æ-—Å–≤—è–∑–∫–∏' },
      { status: 400 }
    );
  }
}
```

## üîÑ **–ö–∞–∫ —Ç–µ–ø–µ—Ä—å —Ä–∞–±–æ—Ç–∞–µ—Ç:**

### **1. –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤ –≤ PhotoUploader:**
```typescript
// File –æ–±—ä–µ–∫—Ç—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–∏
const [mapping, setMapping] = useState<PhotoMapping>({
  mappingType: 'by_sku',
  photoFiles: [File1, File2, File3, ...], // –†–µ–∞–ª—å–Ω—ã–µ File –æ–±—ä–µ–∫—Ç—ã
  mappedPhotos: {}
});
```

### **2. –û—Ç–ø—Ä–∞–≤–∫–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä –≤ DataUpload:**
```typescript
// File –æ–±—ä–µ–∫—Ç—ã –ø—Ä–µ–æ–±—Ä–∞–∑—É—é—Ç—Å—è –≤ –±–µ–∑–æ–ø–∞—Å–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã
const safePhotoMapping = {
  mappingType: mapping.mappingType,
  photoFiles: [
    { name: "photo1.jpg", size: 12345, type: "image/jpeg", lastModified: 1234567890 },
    { name: "photo2.png", size: 67890, type: "image/png", lastModified: 1234567891 },
    // ... —Ç–æ–ª—å–∫–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —Å–≤–æ–π—Å—Ç–≤–∞
  ],
  mappedPhotos: mapping.mappedPhotos
};
```

### **3. –í–∞–ª–∏–¥–∞—Ü–∏—è –≤ API:**
```typescript
// –ü—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è, —á—Ç–æ –Ω–µ—Ç –ø—É—Å—Ç—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤
if (hasEmptyObjects) {
  // –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –æ—à–∏–±–∫–∞ —Å –ø–æ–Ω—è—Ç–Ω—ã–º —Å–æ–æ–±—â–µ–Ω–∏–µ–º
  return NextResponse.json(
    { error: '–û–±–Ω–∞—Ä—É–∂–µ–Ω—ã –ø—É—Å—Ç—ã–µ –æ–±—ä–µ–∫—Ç—ã –≤ –¥–∞–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π' },
    { status: 400 }
  );
}
```

### **4. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ë–î:**
```typescript
// –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è –≤ JSON
updateData.photo_mapping = JSON.stringify(photoMapping);
// –£—Å–ø–µ—à–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤ Prisma
const updatedCategory = await prisma.frontendCategory.update({...});
```

## üéØ **–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**

### **1. –ö–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è:**
- ‚úÖ **–ë–µ–∑–æ–ø–∞—Å–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã** - —Ç–æ–ª—å–∫–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —Å–≤–æ–π—Å—Ç–≤–∞ —Ñ–∞–π–ª–æ–≤
- ‚úÖ **–ù–µ—Ç –ø—É—Å—Ç—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤** - –≤—Å–µ –¥–∞–Ω–Ω—ã–µ —Å–æ–¥–µ—Ä–∂–∞—Ç —Ä–µ–∞–ª—å–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
- ‚úÖ **–°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å JSON** - –æ–±—ä–µ–∫—Ç—ã –º–æ–≥—É—Ç –±—ã—Ç—å —Å–µ—Ä–∏–∞–ª–∏–∑–æ–≤–∞–Ω—ã

### **2. –ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å:**
- ‚úÖ **–í–∞–ª–∏–¥–∞—Ü–∏—è –≤ API** - –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –ø—É—Å—Ç—ã–µ –æ–±—ä–µ–∫—Ç—ã
- ‚úÖ **–ü–æ–Ω—è—Ç–Ω—ã–µ –æ—à–∏–±–∫–∏** - –¥–µ—Ç–∞–ª—å–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö
- ‚úÖ **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** - –ø–æ–ª–Ω–∞—è —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∞ –ø—Ä–æ—Ü–µ—Å—Å–∞

### **3. –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:**
- ‚úÖ **–ú–µ–Ω—å—à–µ –¥–∞–Ω–Ω—ã—Ö** - –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —Å–≤–æ–π—Å—Ç–≤–∞
- ‚úÖ **–ë—ã—Å—Ç—Ä–∞—è —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è** - –Ω–µ—Ç –ø—Ä–æ–±–ª–µ–º–Ω—ã—Ö File –æ–±—ä–µ–∫—Ç–æ–≤
- ‚úÖ **–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ** - –∫–æ–º–ø–∞–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –≤ –ë–î

## üöÄ **–ö–∞–∫ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å:**

### **1. –¢–µ—Å—Ç –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π:**
```
1. –ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ –≤ PhotoUploader
2. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ —Å–≤—è–∑–∫—É —Å —Ç–æ–≤–∞—Ä–∞–º–∏
3. –ù–∞–∂–º–∏—Ç–µ "–ó–∞–≤–µ—Ä—à–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫—É"
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –Ω–µ—Ç –æ—à–∏–±–æ–∫ —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–∏
```

### **2. –¢–µ—Å—Ç –≤–∞–ª–∏–¥–∞—Ü–∏–∏:**
```
1. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ —Å –ø—É—Å—Ç—ã–º–∏ –æ–±—ä–µ–∫—Ç–∞–º–∏
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø–æ–Ω—è—Ç–Ω—É—é –æ—à–∏–±–∫—É
3. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –æ—à–∏–±–∫–∞ –Ω–µ –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ —Å–±–æ—é —Å–∏—Å—Ç–µ–º—ã
```

### **3. –û–∂–∏–¥–∞–µ–º—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã:**
```
‚úÖ –ù–µ—Ç –æ—à–∏–±–æ–∫ "Invalid prisma.frontendCategory.update()"
‚úÖ photoFiles —Å–æ–¥–µ—Ä–∂–∞—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –æ —Ñ–∞–π–ª–∞—Ö
‚úÖ API –≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç –¥–∞–Ω–Ω—ã–µ –ø–µ—Ä–µ–¥ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º
‚úÖ –ü—Ä–æ—Ü–µ—Å—Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π —Ä–∞–±–æ—Ç–∞–µ—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ
```

## üìä **–°—Ä–∞–≤–Ω–µ–Ω–∏–µ –î–û –∏ –ü–û–°–õ–ï:**

### **–î–û:**
```json
{
  "photoMapping": {
    "mappingType": "by_sku",
    "photoFiles": [{},{},{},{},...], // ‚ùå –ü—É—Å—Ç—ã–µ –æ–±—ä–µ–∫—Ç—ã
    "mappedPhotos": {...}
  }
}
```

### **–ü–û–°–õ–ï:**
```json
{
  "photoMapping": {
    "mappingType": "by_sku",
    "photoFiles": [
      {"name": "photo1.jpg", "size": 12345, "type": "image/jpeg", "lastModified": 1234567890},
      {"name": "photo2.png", "size": 67890, "type": "image/png", "lastModified": 1234567891}
    ], // ‚úÖ –ö–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
    "mappedPhotos": {...}
  }
}
```

## üéâ **–†–µ–∑—É–ª—å—Ç–∞—Ç:**

**–ü—Ä–æ–±–ª–µ–º–∞ —Å —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–µ–π photoFiles –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ—à–µ–Ω–∞!**

- ‚úÖ **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è** - File –æ–±—ä–µ–∫—Ç—ã –ø—Ä–µ–æ–±—Ä–∞–∑—É—é—Ç—Å—è –≤ –±–µ–∑–æ–ø–∞—Å–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã
- ‚úÖ **–î–æ–±–∞–≤–ª–µ–Ω–∞ –≤–∞–ª–∏–¥–∞—Ü–∏—è** - API –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –¥–∞–Ω–Ω—ã–µ –ø–µ—Ä–µ–¥ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º
- ‚úÖ **–£–ª—É—á—à–µ–Ω–∞ –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç—å** - –Ω–µ—Ç –ø—É—Å—Ç—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤ –≤ –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ **–ü–æ–Ω—è—Ç–Ω—ã–µ –æ—à–∏–±–∫–∏** - –¥–µ—Ç–∞–ª—å–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –ø—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö
- ‚úÖ **–°—Ç–∞–±–∏–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞** - –ø—Ä–æ—Ü–µ—Å—Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

**–¢–µ–ø–µ—Ä—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π —Ä–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ –æ—à–∏–±–æ–∫ Prisma!** üéØ‚ú®




