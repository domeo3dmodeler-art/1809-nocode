<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç –∏–º–ø–æ—Ä—Ç–∞ –¥–∞–Ω–Ω—ã—Ö - Domeo</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        .header h1 {
            color: #333;
            margin-bottom: 10px;
        }
        .header p {
            color: #666;
        }
        .form-group {
            margin-bottom: 20px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #333;
        }
        input[type="file"], select, button {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
        }
        button {
            background-color: #007bff;
            color: white;
            border: none;
            cursor: pointer;
            margin-top: 10px;
        }
        button:hover {
            background-color: #0056b3;
        }
        .result {
            margin-top: 20px;
            padding: 15px;
            border-radius: 5px;
            display: none;
        }
        .success {
            background-color: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }
        .error {
            background-color: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }
        .loading {
            text-align: center;
            color: #007bff;
        }
        .preview {
            margin-top: 20px;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 5px;
            border: 1px solid #dee2e6;
        }
        .preview h3 {
            margin-top: 0;
            color: #333;
        }
        .preview pre {
            background-color: #fff;
            padding: 10px;
            border-radius: 3px;
            overflow-x: auto;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üöÄ –¢–µ—Å—Ç –∏–º–ø–æ—Ä—Ç–∞ –¥–∞–Ω–Ω—ã—Ö</h1>
            <p>–°–∏—Å—Ç–µ–º–∞ Domeo - No-Code –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ –¥–ª—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ç–æ—Ä–æ–≤ —Ç–æ–≤–∞—Ä–æ–≤</p>
        </div>

        <form id="importForm">
            <div class="form-group">
                <label for="category">–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é:</label>
                <select id="category" name="category" required>
                    <option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é --</option>
                    <option value="doors">–î–≤–µ—Ä–∏</option>
                    <option value="windows">–û–∫–Ω–∞</option>
                    <option value="furniture">–ú–µ–±–µ–ª—å</option>
                </select>
            </div>

            <div class="form-group">
                <label for="file">–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞:</label>
                <input type="file" id="file" name="file" accept=".csv,.xlsx,.xls" required>
                <small>–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è —Ñ–æ—Ä–º–∞—Ç—ã: CSV, Excel (.xlsx, .xls)</small>
            </div>

            <button type="submit">üì• –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ</button>
        </form>

        <div id="loading" class="result loading" style="display: none;">
            <p>‚è≥ –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Ñ–∞–π–ª...</p>
        </div>

        <div id="result" class="result"></div>

        <div class="preview">
            <h3>üìã –ü—Ä–∏–º–µ—Ä –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞:</h3>
            <p>–°–æ–∑–¥–∞–π—Ç–µ CSV —Ñ–∞–π–ª —Å–æ —Å–ª–µ–¥—É—é—â–∏–º–∏ –∑–∞–≥–æ–ª–æ–≤–∫–∞–º–∏:</p>
            <pre>–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ,–ê—Ä—Ç–∏–∫—É–ª,–¶–µ–Ω–∞,–®–∏—Ä–∏–Ω–∞,–í—ã—Å–æ—Ç–∞,–ú–∞—Ç–µ—Ä–∏–∞–ª,–¶–≤–µ—Ç,–û–ø–∏—Å–∞–Ω–∏–µ
–î–≤–µ—Ä—å –º–µ–∂–∫–æ–º–Ω–∞—Ç–Ω–∞—è "–ö–ª–∞—Å—Å–∏–∫–∞",DM-001,15000,800,2000,–ú–∞—Å—Å–∏–≤ –¥—É–±–∞,–ë–µ–ª—ã–π,–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∞—è –º–µ–∂–∫–æ–º–Ω–∞—Ç–Ω–∞—è –¥–≤–µ—Ä—å
–î–≤–µ—Ä—å –º–µ–∂–∫–æ–º–Ω–∞—Ç–Ω–∞—è "–ú–æ–¥–µ—Ä–Ω",DM-002,12000,700,2000,–ú–î–§,–°–µ—Ä—ã–π,–°–æ–≤—Ä–µ–º–µ–Ω–Ω–∞—è –º–µ–∂–∫–æ–º–Ω–∞—Ç–Ω–∞—è –¥–≤–µ—Ä—å
–î–≤–µ—Ä—å –≤—Ö–æ–¥–Ω–∞—è "–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å",DV-001,25000,900,2100,–ú–µ—Ç–∞–ª–ª,–ö–æ—Ä–∏—á–Ω–µ–≤—ã–π,–í—Ö–æ–¥–Ω–∞—è –º–µ—Ç–∞–ª–ª–∏—á–µ—Å–∫–∞—è –¥–≤–µ—Ä—å</pre>
        </div>
    </div>

    <script>
        document.getElementById('importForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const formData = new FormData();
            const fileInput = document.getElementById('file');
            const categorySelect = document.getElementById('category');
            const resultDiv = document.getElementById('result');
            const loadingDiv = document.getElementById('loading');
            
            if (!fileInput.files[0] || !categorySelect.value) {
                showResult('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª –∏ –∫–∞—Ç–µ–≥–æ—Ä–∏—é', 'error');
                return;
            }
            
            formData.append('file', fileInput.files[0]);
            formData.append('category', categorySelect.value);
            formData.append('mode', 'headers'); // –°–Ω–∞—á–∞–ª–∞ —á–∏—Ç–∞–µ–º –∑–∞–≥–æ–ª–æ–≤–∫–∏
            
            showLoading();
            
            try {
                const response = await fetch('/api/admin/import/universal', {
                    method: 'POST',
                    body: formData
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    showResult(`‚úÖ –§–∞–π–ª —É—Å–ø–µ—à–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω!<br>
                        üìä –ó–∞–≥–æ–ª–æ–≤–∫–æ–≤ –Ω–∞–π–¥–µ–Ω–æ: ${data.headers.length}<br>
                        üìã –ó–∞–≥–æ–ª–æ–≤–∫–∏: ${data.headers.join(', ')}<br>
                        üíæ –°—Ö–µ–º–∞ —Å–æ–∑–¥–∞–Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏`, 'success');
                    
                    // –¢–µ–ø–µ—Ä—å –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ–ª–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
                    await importFullData(fileInput.files[0], categorySelect.value);
                } else {
                    showResult(`‚ùå –û—à–∏–±–∫–∞: ${data.error}`, 'error');
                }
            } catch (error) {
                showResult(`‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ç–∏: ${error.message}`, 'error');
            }
        });
        
        async function importFullData(file, category) {
            const formData = new FormData();
            formData.append('file', file);
            formData.append('category', category);
            formData.append('mode', 'full'); // –ü–æ–ª–Ω—ã–π –∏–º–ø–æ—Ä—Ç
            
            try {
                const response = await fetch('/api/admin/import/universal', {
                    method: 'POST',
                    body: formData
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    showResult(`üéâ –ò–º–ø–æ—Ä—Ç –∑–∞–≤–µ—Ä—à–µ–Ω!<br>
                        üì¶ –¢–æ–≤–∞—Ä–æ–≤ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–æ: ${data.imported}<br>
                        üìä –í—Å–µ–≥–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ: ${data.total_rows}<br>
                        ‚úÖ –£—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ: ${data.database_saved}<br>
                        ‚ùå –û—à–∏–±–æ–∫: ${data.failed_products}<br>
                        üíæ –°–æ–æ–±—â–µ–Ω–∏–µ: ${data.save_message}`, 'success');
                } else {
                    showResult(`‚ùå –û—à–∏–±–∫–∞ –ø–æ–ª–Ω–æ–≥–æ –∏–º–ø–æ—Ä—Ç–∞: ${data.error}`, 'error');
                }
            } catch (error) {
                showResult(`‚ùå –û—à–∏–±–∫–∞ –ø–æ–ª–Ω–æ–≥–æ –∏–º–ø–æ—Ä—Ç–∞: ${error.message}`, 'error');
            }
        }
        
        function showLoading() {
            document.getElementById('loading').style.display = 'block';
            document.getElementById('result').style.display = 'none';
        }
        
        function showResult(message, type) {
            const resultDiv = document.getElementById('result');
            const loadingDiv = document.getElementById('loading');
            
            loadingDiv.style.display = 'none';
            resultDiv.className = `result ${type}`;
            resultDiv.innerHTML = message;
            resultDiv.style.display = 'block';
        }
    </script>
</body>
</html>
