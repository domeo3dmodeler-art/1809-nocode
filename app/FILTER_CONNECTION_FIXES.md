# ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–≤—è–∑–µ–π –º–µ–∂–¥—É —Ñ–∏–ª—å—Ç—Ä–∞–º–∏

## üéØ **–ü—Ä–æ–±–ª–µ–º—ã:**
1. **–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –Ω—É–º–µ—Ä–∞—Ü–∏—è –±–ª–æ–∫–æ–≤** - –æ–±–∞ –±–ª–æ–∫–∞ –ø–æ–∫–∞–∑—ã–≤–∞–ª–∏ –Ω–æ–º–µ—Ä "2"
2. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Å–≤—è–∑–∏ –º–µ–∂–¥—É –±–ª–æ–∫–∞–º–∏** - —Ñ–∏–ª—å—Ç—Ä—ã –Ω–µ –≤–ª–∏—è–ª–∏ –¥—Ä—É–≥ –Ω–∞ –¥—Ä—É–≥–∞
3. **–ù–µ—Ç –æ–±—â–∏—Ö —Å–≤–æ–π—Å—Ç–≤ —Ç–æ–≤–∞—Ä–æ–≤** - –±–ª–æ–∫–∏ —Ä–∞–±–æ—Ç–∞–ª–∏ –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ

## üîß **–†–µ—à–µ–Ω–∏—è:**

### **1. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –Ω—É–º–µ—Ä–∞—Ü–∏—è –±–ª–æ–∫–æ–≤**

**–ü—Ä–æ–±–ª–µ–º–∞:** –û–±–∞ –±–ª–æ–∫–∞ –ø–æ–∫–∞–∑—ã–≤–∞–ª–∏ "–§–∏–ª—å—Ç—Ä —Å–≤–æ–π—Å—Ç–≤ 2"

**–†–µ—à–µ–Ω–∏–µ:** –ò–∑–º–µ–Ω–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ –≤ `getBlockNameWithNumber`:
```typescript
// lib/block-names.ts
export function getBlockNameWithNumber(type: string, existingElements: any[] = [], currentElementId?: string): string {
  const baseName = getBlockName(type);
  
  // –ù–∞—Ö–æ–¥–∏–º –≤—Å–µ —ç–ª–µ–º–µ–Ω—Ç—ã —ç—Ç–æ–≥–æ —Ç–∏–ø–∞
  const sameTypeElements = existingElements.filter(el => el.type === type);
  
  // –ï—Å–ª–∏ —ç—Ç–æ –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π —ç–ª–µ–º–µ–Ω—Ç —Ç–∞–∫–æ–≥–æ —Ç–∏–ø–∞, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –±–µ–∑ –Ω–æ–º–µ—Ä–∞
  if (sameTypeElements.length <= 1) {
    return baseName;
  }
  
  // –ù–∞—Ö–æ–¥–∏–º –ø–æ–∑–∏—Ü–∏—é —Ç–µ–∫—É—â–µ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞ —Å—Ä–µ–¥–∏ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ —ç—Ç–æ–≥–æ —Ç–∏–ø–∞
  const currentIndex = sameTypeElements.findIndex(el => el.id === currentElementId);
  
  // –ï—Å–ª–∏ —ç–ª–µ–º–µ–Ω—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω –∏–ª–∏ —ç—Ç–æ –ø–µ—Ä–≤—ã–π, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –±–µ–∑ –Ω–æ–º–µ—Ä–∞
  if (currentIndex <= 0) {
    return baseName;
  }
  
  // –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–º–µ—Ä (–ø–æ–∑–∏—Ü–∏—è + 1)
  return `${baseName} ${currentIndex + 1}`;
}
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- **"–§–∏–ª—å—Ç—Ä —Å–≤–æ–π—Å—Ç–≤"** (–ø–µ—Ä–≤—ã–π –±–ª–æ–∫)
- **"–§–∏–ª—å—Ç—Ä —Å–≤–æ–π—Å—Ç–≤ 2"** (–≤—Ç–æ—Ä–æ–π –±–ª–æ–∫)
- **"–§–∏–ª—å—Ç—Ä —Å–≤–æ–π—Å—Ç–≤ 3"** (—Ç—Ä–µ—Ç–∏–π –±–ª–æ–∫)

### **2. –°–æ–∑–¥–∞–Ω API –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤**

**–ù–æ–≤—ã–π API:** `/api/catalog/products/filtered`

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:**
- –ü—Ä–∏–Ω–∏–º–∞–µ—Ç `categoryIds`, `propertyName` –∏ `filters`
- –§–∏–ª—å—Ç—Ä—É–µ—Ç —Ç–æ–≤–∞—Ä—ã –ø–æ –∑–∞–¥–∞–Ω–Ω—ã–º —Ñ–∏–ª—å—Ç—Ä–∞–º
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è —Å–≤–æ–π—Å—Ç–≤–∞ –¥–ª—è –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤

```typescript
// app/api/catalog/products/filtered/route.ts
export async function GET(request: NextRequest) {
  // –ó–∞–≥—Ä—É–∂–∞–µ–º —Ç–æ–≤–∞—Ä—ã —Å —É—á–µ—Ç–æ–º —Ñ–∏–ª—å—Ç—Ä–æ–≤
  const products = await prisma.product.findMany({
    where: {
      catalog_category_id: { in: categoryIds },
      is_active: true
    },
    select: {
      id: true,
      sku: true,
      name: true,
      properties_data: true
    }
  });

  // –§–∏–ª—å—Ç—Ä—É–µ–º —Ç–æ–≤–∞—Ä—ã –ø–æ –∑–Ω–∞—á–µ–Ω–∏—è–º —Å–≤–æ–π—Å—Ç–≤
  const filteredProducts = products.filter(product => {
    const props = JSON.parse(product.properties_data);
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤—Å–µ —Ñ–∏–ª—å—Ç—Ä—ã
    for (const [filterPropertyName, filterValue] of Object.entries(filters)) {
      if (props[filterPropertyName] !== filterValue) {
        return false;
      }
    }
    
    return props.hasOwnProperty(propertyName);
  });

  // –ò–∑–≤–ª–µ–∫–∞–µ–º —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –Ω—É–∂–Ω–æ–≥–æ —Å–≤–æ–π—Å—Ç–≤–∞
  // ...
}
```

### **3. –£–ª—É—á—à–µ–Ω–∞ –ø–µ—Ä–µ–¥–∞—á–∞ –¥–∞–Ω–Ω—ã—Ö –º–µ–∂–¥—É –±–ª–æ–∫–∞–º–∏**

**–í PageBuilder.tsx:**
```typescript
// –ï—Å–ª–∏ —Ü–µ–ª–µ–≤–æ–π —ç–ª–µ–º–µ–Ω—Ç - PropertyFilter, –æ–±–Ω–æ–≤–ª—è–µ–º –µ–≥–æ —Ñ–∏–ª—å—Ç—Ä—ã
if (targetElement.type === 'propertyFilter') {
  // –ü–µ—Ä–µ–¥–∞–µ–º —Ñ–∏–ª—å—Ç—Ä –ø–æ —Å–≤–æ–π—Å—Ç–≤—É —Ç–æ–≤–∞—Ä–∞
  const propertyName = data.propertyName;
  const propertyValue = data.value || data;
  
  // –û–±–Ω–æ–≤–ª—è–µ–º —Ñ–∏–ª—å—Ç—Ä—ã —Ü–µ–ª–µ–≤–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞
  const currentFilters = targetElement.props.filters || {};
  const newFilters = {
    ...currentFilters,
    [propertyName]: propertyValue
  };
  
  const updates: Partial<BaseElement> = {
    props: {
      ...targetElement.props,
      filters: newFilters
    }
  };
  handleUpdateElement(connection.targetElementId, updates);
}
```

### **4. –û–±–Ω–æ–≤–ª–µ–Ω PropertyFilter –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ñ–∏–ª—å—Ç—Ä–∞–º–∏**

**–í PropertyFilter.tsx:**
- –î–æ–±–∞–≤–ª–µ–Ω–∞ —Ä–µ–∞–∫—Ü–∏—è –Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è `element.props.filters`
- –õ–æ–≥–∏–∫–∞ –≤—ã–±–æ—Ä–∞ API (—Å —Ñ–∏–ª—å—Ç—Ä–∞–º–∏ –∏–ª–∏ –±–µ–∑)
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ API –∫–æ–≥–¥–∞ –µ—Å—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã

```typescript
// –ï—Å–ª–∏ –µ—Å—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã, –∏—Å–ø–æ–ª—å–∑—É–µ–º –Ω–æ–≤—ã–π API –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤
if (element.props.filters && Object.keys(element.props.filters).length > 0) {
  const query = new URLSearchParams();
  element.props.categoryIds.forEach((id: string) => {
    query.append('categoryIds', id);
  });
  query.append('propertyName', propertyName);
  query.append('filters', JSON.stringify(element.props.filters));

  response = await fetch(`/api/catalog/products/filtered?${query.toString()}`);
} else {
  // –û–±—ã—á–Ω—ã–π –∑–∞–ø—Ä–æ—Å –±–µ–∑ —Ñ–∏–ª—å—Ç—Ä–æ–≤
  response = await fetch(`/api/catalog/properties/unique-values?${query.toString()}`);
}
```

## üß™ **–ö–∞–∫ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å:**

### **1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω—É–º–µ—Ä–∞—Ü–∏–∏:**
1. **–î–æ–±–∞–≤—å—Ç–µ –Ω–µ—Å–∫–æ–ª—å–∫–æ –±–ª–æ–∫–æ–≤ "–§–∏–ª—å—Ç—Ä —Å–≤–æ–π—Å—Ç–≤"**
2. **–í—ã–¥–µ–ª–∏—Ç–µ –∫–∞–∂–¥—ã–π –±–ª–æ–∫** - –¥–æ–ª–∂–Ω—ã –ø–æ—è–≤–∏—Ç—å—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –Ω–æ–º–µ—Ä–∞:
   - –ü–µ—Ä–≤—ã–π: "–§–∏–ª—å—Ç—Ä —Å–≤–æ–π—Å—Ç–≤"
   - –í—Ç–æ—Ä–æ–π: "–§–∏–ª—å—Ç—Ä —Å–≤–æ–π—Å—Ç–≤ 2"
   - –¢—Ä–µ—Ç–∏–π: "–§–∏–ª—å—Ç—Ä —Å–≤–æ–π—Å—Ç–≤ 3"

### **2. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–≤—è–∑–µ–π –º–µ–∂–¥—É —Ñ–∏–ª—å—Ç—Ä–∞–º–∏:**
1. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–µ—Ä–≤—ã–π –±–ª–æ–∫** –Ω–∞ —Å–≤–æ–π—Å—Ç–≤–æ "Domeo_–°—Ç–∏–ª—å Web"
2. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ –≤—Ç–æ—Ä–æ–π –±–ª–æ–∫** –Ω–∞ —Å–≤–æ–π—Å—Ç–≤–æ "Domeo_–ù–∞–∑–≤–∞–Ω–∏–µ –º–æ–¥–µ–ª–∏ –¥–ª—è Web"
3. **–°–æ–∑–¥–∞–π—Ç–µ —Å–≤—è–∑—å** "–§–∏–ª—å—Ç—Ä—ã ‚Üí (–æ—Ç –ø–µ—Ä–≤–æ–≥–æ –∫–æ –≤—Ç–æ—Ä–æ–º—É)"
4. **–í—ã–±–µ—Ä–∏—Ç–µ —Å—Ç–∏–ª—å** –≤ –ø–µ—Ä–≤–æ–º –±–ª–æ–∫–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, "–°–∫—Ä—ã—Ç–∞—è")
5. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤—Ç–æ—Ä–æ–π –±–ª–æ–∫** - –¥–æ–ª–∂–Ω—ã –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è —Ç–æ–ª—å–∫–æ –º–æ–¥–µ–ª–∏ –¥–ª—è –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ —Å—Ç–∏–ª—è

### **3. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã —Ñ–∏–ª—å—Ç—Ä–æ–≤:**
1. **–û—Ç–∫—Ä–æ–π—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞** –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –ª–æ–≥–æ–≤
2. **–í—ã–±–µ—Ä–∏—Ç–µ –∑–Ω–∞—á–µ–Ω–∏–µ** –≤ –ø–µ—Ä–≤–æ–º –±–ª–æ–∫–µ
3. **–í –∫–æ–Ω—Å–æ–ª–∏ –¥–æ–ª–∂–Ω—ã –ø–æ—è–≤–∏—Ç—å—Å—è —Å–æ–æ–±—â–µ–Ω–∏—è:**
   ```
   üîó handleConnectionData –≤—ã–∑–≤–∞–Ω–∞: {sourceElementId: "...", data: {...}}
   üîç –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Ñ–∏–ª—å—Ç—Ä–æ–≤: {...}
   PropertyFilter: –ó–∞–ø—Ä–æ—Å –∫ API —Å —Ñ–∏–ª—å—Ç—Ä–∞–º–∏: /api/catalog/products/filtered?...
   PropertyFilter: –û—Ç–≤–µ—Ç API —Å —Ñ–∏–ª—å—Ç—Ä–∞–º–∏: {...}
   ```

### **4. –ü—Ä–æ–≤–µ—Ä–∫–∞ API:**
1. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–±–æ—Ç—É API** –Ω–∞–ø—Ä—è–º—É—é:
   ```
   GET /api/catalog/products/filtered?categoryIds=cmg50xcgs001cv7mn0tdyk1wo&propertyName=Domeo_–ù–∞–∑–≤–∞–Ω–∏–µ%20–º–æ–¥–µ–ª–∏%20–¥–ª—è%20Web&filters={"Domeo_–°—Ç–∏–ª—å Web":"–°–∫—Ä—ã—Ç–∞—è"}
   ```
2. **–î–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å** —Ç–æ–ª—å–∫–æ –º–æ–¥–µ–ª–∏ –¥–ª—è —Å—Ç–∏–ª—è "–°–∫—Ä—ã—Ç–∞—è"

## üìã **–ò–∑–º–µ–Ω–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:**

1. **`lib/block-names.ts`**
   - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ –Ω—É–º–µ—Ä–∞—Ü–∏–∏ –±–ª–æ–∫–æ–≤

2. **`app/api/catalog/products/filtered/route.ts`** (–Ω–æ–≤—ã–π)
   - API –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–æ–≤–∞—Ä–æ–≤ —Å —Ñ–∏–ª—å—Ç—Ä–∞–º–∏

3. **`components/page-builder/PageBuilder.tsx`**
   - –£–ª—É—á—à–µ–Ω–∞ –ø–µ—Ä–µ–¥–∞—á–∞ –¥–∞–Ω–Ω—ã—Ö –º–µ–∂–¥—É –±–ª–æ–∫–∞–º–∏

4. **`components/page-builder/elements/PropertyFilter.tsx`**
   - –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ —Ñ–∏–ª—å—Ç—Ä–æ–≤
   - –í—ã–±–æ—Ä API –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –Ω–∞–ª–∏—á–∏—è —Ñ–∏–ª—å—Ç—Ä–æ–≤

## ‚úÖ **–†–µ–∑—É–ª—å—Ç–∞—Ç:**

- ‚úÖ **–ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –Ω—É–º–µ—Ä–∞—Ü–∏—è** - –±–ª–æ–∫–∏ –∏–º–µ—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –Ω–æ–º–µ—Ä–∞
- ‚úÖ **–†–∞–±–æ—Ç–∞—é—â–∏–µ —Å–≤—è–∑–∏** - —Ñ–∏–ª—å—Ç—Ä—ã –≤–ª–∏—è—é—Ç –¥—Ä—É–≥ –Ω–∞ –¥—Ä—É–≥–∞
- ‚úÖ **–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ —Å–≤–æ–π—Å—Ç–≤–∞–º** - –≤—Ç–æ—Ä–æ–π –±–ª–æ–∫ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ç–æ–ª—å–∫–æ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
- ‚úÖ **–ù–æ–≤—ã–π API** - –ø–æ–¥–¥–µ—Ä–∂–∫–∞ —Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
- ‚úÖ **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** - –ø–æ–¥—Ä–æ–±–Ω—ã–µ –ª–æ–≥–∏ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏

---

**–¢–µ–ø–µ—Ä—å –±–ª–æ–∫–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ —Å–≤—è–∑–∞–Ω—ã –∏ —Ñ–∏–ª—å—Ç—Ä—ã —Ä–∞–±–æ—Ç–∞—é—Ç –∫–∞–∫ –æ–∂–∏–¥–∞–µ—Ç—Å—è! üöÄ**

