<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç —Å–≤—è–∑–∏ —Ñ–∏–ª—å—Ç—Ä–æ–≤</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        .step {
            background: #f5f5f5;
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
        }
        .success {
            background: #d4edda;
            color: #155724;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
        }
        .warning {
            background: #fff3cd;
            color: #856404;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #0056b3;
        }
        .log {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            font-family: monospace;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <h1>üîç –¢–µ—Å—Ç —Å–≤—è–∑–∏ –º–µ–∂–¥—É —Ñ–∏–ª—å—Ç—Ä–∞–º–∏</h1>
    
    <div class="step">
        <h2>–®–∞–≥ 1: –°–æ–∑–¥–∞–Ω–∏–µ —Å–≤—è–∑–∏</h2>
        <p>1. –í—ã–±–µ—Ä–∏—Ç–µ –≤–µ—Ä—Ö–Ω–∏–π —Ñ–∏–ª—å—Ç—Ä (—Å—Ç–∏–ª–∏)</p>
        <p>2. –ó–∞–∂–º–∏—Ç–µ <strong>Ctrl</strong> –∏ –∫–ª–∏–∫–Ω–∏—Ç–µ –Ω–∞ –Ω–∏–∂–Ω–∏–π —Ñ–∏–ª—å—Ç—Ä (–º–æ–¥–µ–ª–∏)</p>
        <p>3. –í –º–µ–Ω—é –≤—ã–±–µ—Ä–∏—Ç–µ: <strong>üîç –§–∏–ª—å—Ç—Ä—ã ‚Üí (–æ—Ç –ø–µ—Ä–≤–æ–≥–æ –∫–æ –≤—Ç–æ—Ä–æ–º—É)</strong></p>
        <p>4. –ù–∞–∂–º–∏—Ç–µ <strong>"–°–æ–∑–¥–∞—Ç—å —Å–≤—è–∑—å"</strong></p>
        <button onclick="checkConnection()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–≤—è–∑—å</button>
    </div>

    <div class="step">
        <h2>–®–∞–≥ 2: –¢–µ—Å—Ç —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏</h2>
        <p>1. –í—ã–±–µ—Ä–∏—Ç–µ –∑–Ω–∞—á–µ–Ω–∏–µ –≤ –≤–µ—Ä—Ö–Ω–µ–º —Ñ–∏–ª—å—Ç—Ä–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, "–°–æ–≤—Ä–µ–º–µ–Ω–Ω–∞—è")</p>
        <p>2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –≤ –∫–æ–Ω—Å–æ–ª–∏ –ø–æ—è–≤–∏–ª–∏—Å—å –ª–æ–≥–∏</p>
        <button onclick="showExpectedLogs()">–ü–æ–∫–∞–∑–∞—Ç—å –æ–∂–∏–¥–∞–µ–º—ã–µ –ª–æ–≥–∏</button>
    </div>

    <div class="step">
        <h2>–®–∞–≥ 3: –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞</h2>
        <p>–ï—Å–ª–∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:</p>
        <ul>
            <li>–ï—Å—Ç—å –ª–∏ —Å–≤—è–∑—å –º–µ–∂–¥—É —Ñ–∏–ª—å—Ç—Ä–∞–º–∏ –≤ –ø–∞–Ω–µ–ª–∏ —Å–ø—Ä–∞–≤–∞</li>
            <li>–ü—Ä–∞–≤–∏–ª—å–Ω–æ –ª–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã —Å–≤–æ–π—Å—Ç–≤–∞ —É –∫–∞–∂–¥–æ–≥–æ —Ñ–∏–ª—å—Ç—Ä–∞</li>
            <li>–ï—Å—Ç—å –ª–∏ –æ—à–∏–±–∫–∏ –≤ –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞</li>
        </ul>
        <button onclick="runDiagnostics()">–ó–∞–ø—É—Å—Ç–∏—Ç—å –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É</button>
    </div>

    <div id="results"></div>

    <script>
        function checkConnection() {
            const results = document.getElementById('results');
            results.innerHTML = '<div class="log">–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–µ —Å—Ç—Ä–∞–Ω–∏—Ü:\n1. –û—Ç–∫—Ä–æ–π—Ç–µ –ø—Ä–∞–≤—É—é –ø–∞–Ω–µ–ª—å "–°–≤—è–∑–∏ –º–µ–∂–¥—É –±–ª–æ–∫–∞–º–∏"\n2. –î–æ–ª–∂–Ω–∞ –±—ã—Ç—å –∞–∫—Ç–∏–≤–Ω–∞—è —Å–≤—è–∑—å —Ç–∏–ø–∞ "–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Ñ–∏–ª—å—Ç—Ä–æ–≤"\n3. –ï—Å–ª–∏ —Å–≤—è–∑–∏ –Ω–µ—Ç - —Å–æ–∑–¥–∞–π—Ç–µ –µ—ë —á–µ—Ä–µ–∑ Ctrl+–∫–ª–∏–∫</div>';
        }

        function showExpectedLogs() {
            const results = document.getElementById('results');
            results.innerHTML = `<div class="log">–û–∂–∏–¥–∞–µ–º—ã–µ –ª–æ–≥–∏ –≤ –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞ (F12):

üîó PropertyFilter –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –¥–∞–Ω–Ω—ã–µ: {
  elementId: 'element-xxx',
  propertyName: 'Domeo_–°—Ç–∏–ª—å Web',
  value: '–°–æ–≤—Ä–µ–º–µ–Ω–Ω–∞—è',
  categoryIds: ['cmg50xcgs001cv7mn0tdyk1wo']
}

üîó handleConnectionData –≤—ã–∑–≤–∞–Ω–∞: {
  sourceElementId: 'element-xxx',
  data: {type: 'filter', propertyName: 'Domeo_–°—Ç–∏–ª—å Web', value: '–°–æ–≤—Ä–µ–º–µ–Ω–Ω–∞—è'}
}

üîó –ù–∞–π–¥–µ–Ω—ã –∏—Å—Ö–æ–¥—è—â–∏–µ —Å–≤—è–∑–∏: Array(1)
üîç –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Ñ–∏–ª—å—Ç—Ä–æ–≤: {...}
üîç –û–±–Ω–æ–≤–ª—è–µ–º PropertyFilter —Ñ–∏–ª—å—Ç—Ä: {...}

GET /api/catalog/products/filtered?categoryIds=...&propertyName=Domeo_–ù–∞–∑–≤–∞–Ω–∏–µ –º–æ–¥–µ–ª–∏ –¥–ª—è Web&filters={"Domeo_–°—Ç–∏–ª—å Web":"–°–æ–≤—Ä–µ–º–µ–Ω–Ω–∞—è"}</div>`;
        }

        function runDiagnostics() {
            const results = document.getElementById('results');
            results.innerHTML = `<div class="step">
                <h3>üîß –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º</h3>
                <div class="warning">
                    <strong>–ï—Å–ª–∏ –ù–ï–¢ –ª–æ–≥–æ–≤ "üîó PropertyFilter –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –¥–∞–Ω–Ω—ã–µ":</strong><br>
                    - –°–≤—è–∑—å –Ω–µ —Å–æ–∑–¥–∞–Ω–∞ –∏–ª–∏ –Ω–µ–∞–∫—Ç–∏–≤–Ω–∞<br>
                    - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–∞–Ω–µ–ª—å "–°–≤—è–∑–∏ –º–µ–∂–¥—É –±–ª–æ–∫–∞–º–∏"
                </div>
                <div class="warning">
                    <strong>–ï—Å–ª–∏ –µ—Å—Ç—å –ª–æ–≥–∏ –æ—Ç–ø—Ä–∞–≤–∫–∏, –Ω–æ –ù–ï–¢ "üîó handleConnectionData":</strong><br>
                    - –ü—Ä–æ–±–ª–µ–º–∞ –≤ —Å–∏—Å—Ç–µ–º–µ —Å–≤—è–∑–µ–π<br>
                    - –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É
                </div>
                <div class="warning">
                    <strong>–ï—Å–ª–∏ –µ—Å—Ç—å "üîó –ù–∞–π–¥–µ–Ω—ã –∏—Å—Ö–æ–¥—è—â–∏–µ —Å–≤—è–∑–∏: Array(0)":</strong><br>
                    - –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–≤—è–∑–∏<br>
                    - –ü–µ—Ä–µ—Å–æ–∑–¥–∞–π—Ç–µ —Å–≤—è–∑—å —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ–º
                </div>
                <div class="warning">
                    <strong>–ï—Å–ª–∏ –µ—Å—Ç—å –æ—à–∏–±–∫–∞ API:</strong><br>
                    - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞ –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª–µ<br>
                    - –û—á–∏—Å—Ç–∏—Ç–µ –∫—ç—à: POST /api/cache/clear
                </div>
            </div>`;
        }
    </script>
</body>
</html>

