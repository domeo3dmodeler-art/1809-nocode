# ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ñ–∏–ª—å—Ç—Ä–æ–≤

## üéØ **–ü—Ä–æ–±–ª–µ–º–∞:**
–§–∏–ª—å—Ç—Ä—ã –Ω–µ —Ä–∞–±–æ—Ç–∞–ª–∏ –∏–∑-–∑–∞ –æ—à–∏–±–∫–∏ Prisma –≤ API `/api/catalog/filters/route.ts`:
```
Unknown field `properties` for select statement on model `Product`
```

## üîß **–†–µ—à–µ–Ω–∏–µ:**

### **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω API `/api/catalog/filters/route.ts`:**

**–ë—ã–ª–æ:**
```typescript
const products = await prisma.product.findMany({
  where: {
    categoryId: { in: categoryIds },
    isActive: true
  },
  include: {
    properties: true  // ‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –ø–æ–ª–µ
  }
});

products.forEach(product => {
  product.properties.forEach(property => {  // ‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞
    // ...
  });
});
```

**–°—Ç–∞–ª–æ:**
```typescript
const products = await prisma.product.findMany({
  where: {
    catalog_category_id: { in: categoryIds },  // ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ –ø–æ–ª–µ
    is_active: true  // ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ –ø–æ–ª–µ
  },
  select: {
    id: true,
    properties_data: true  // ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ –ø–æ–ª–µ
  }
});

products.forEach(product => {
  if (product.properties_data) {
    try {
      const props = typeof product.properties_data === 'string' 
        ? JSON.parse(product.properties_data) 
        : product.properties_data;
      
      Object.entries(props).forEach(([propertyName, propertyValue]) => {
        // ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ JSON –¥–∞–Ω–Ω—ã—Ö
        // ...
      });
    } catch (error) {
      console.warn(`Error parsing properties for product ${product.id}:`, error);
    }
  }
});
```

## üìã **–ò–∑–º–µ–Ω–µ–Ω–∏—è:**

1. **–ü–æ–ª—è –º–æ–¥–µ–ª–∏:** `categoryId` ‚Üí `catalog_category_id`, `isActive` ‚Üí `is_active`
2. **–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö:** `include: { properties: true }` ‚Üí `select: { properties_data: true }`
3. **–û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö:** –ü–∞—Ä—Å–∏–Ω–≥ JSON –∏–∑ `properties_data` –≤–º–µ—Å—Ç–æ –¥–æ—Å—Ç—É–ø–∞ –∫ `product.properties`
4. **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫:** –î–æ–±–∞–≤–ª–µ–Ω try-catch –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞ JSON

## üß™ **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:**

### **1. –ü—Ä–æ–≤–µ—Ä–∫–∞ API:**
```bash
POST /api/catalog/filters
{
  "categoryIds": ["cmg50xcgs001cv7mn0tdyk1wo"]
}
```

### **2. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–∏–ª—å—Ç—Ä–æ–≤ –≤ PropertyFilter:**
1. **–î–æ–±–∞–≤—å—Ç–µ –±–ª–æ–∫ "–§–∏–ª—å—Ç—Ä —Å–≤–æ–π—Å—Ç–≤"**
2. **–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é —Ç–æ–≤–∞—Ä–æ–≤**
3. **–í—ã–±–µ—Ä–∏—Ç–µ —Å–≤–æ–π—Å—Ç–≤–æ** (–Ω–∞–ø—Ä–∏–º–µ—Ä, "Domeo_–°—Ç–∏–ª—å Web")
4. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è**

### **3. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–≤—è–∑–µ–π –º–µ–∂–¥—É —Ñ–∏–ª—å—Ç—Ä–∞–º–∏:**
1. **–°–æ–∑–¥–∞–π—Ç–µ –¥–≤–∞ –±–ª–æ–∫–∞ PropertyFilter**
2. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–µ—Ä–≤—ã–π** –Ω–∞ "Domeo_–°—Ç–∏–ª—å Web"
3. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ –≤—Ç–æ—Ä–æ–π** –Ω–∞ "Domeo_–ù–∞–∑–≤–∞–Ω–∏–µ –º–æ–¥–µ–ª–∏ –¥–ª—è Web"
4. **–°–æ–∑–¥–∞–π—Ç–µ —Å–≤—è–∑—å** "–§–∏–ª—å—Ç—Ä—ã ‚Üí (–æ—Ç –ø–µ—Ä–≤–æ–≥–æ –∫–æ –≤—Ç–æ—Ä–æ–º—É)"
5. **–í—ã–±–µ—Ä–∏—Ç–µ —Å—Ç–∏–ª—å** –≤ –ø–µ—Ä–≤–æ–º –±–ª–æ–∫–µ
6. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –≤—Ç–æ—Ä–æ–π –±–ª–æ–∫** –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ç–æ–ª—å–∫–æ –º–æ–¥–µ–ª–∏ –¥–ª—è –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ —Å—Ç–∏–ª—è

## ‚úÖ **–†–µ–∑—É–ª—å—Ç–∞—Ç:**

- ‚úÖ **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –æ—à–∏–±–∫–∞ Prisma** - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –ø–æ–ª–µ `properties_data`
- ‚úÖ **API —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ** - —Ñ–∏–ª—å—Ç—Ä—ã –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫
- ‚úÖ **–°–≤—è–∑–∏ –º–µ–∂–¥—É –±–ª–æ–∫–∞–º–∏** - —Ñ–∏–ª—å—Ç—Ä—ã –≤–ª–∏—è—é—Ç –¥—Ä—É–≥ –Ω–∞ –¥—Ä—É–≥–∞
- ‚úÖ **–ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –Ω—É–º–µ—Ä–∞—Ü–∏—è** - –±–ª–æ–∫–∏ –∏–º–µ—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –Ω–æ–º–µ—Ä–∞
- ‚úÖ **–°–µ—Ä–≤–µ—Ä –ø–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω** - –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø—Ä–∏–º–µ–Ω–µ–Ω—ã

---

**–§–∏–ª—å—Ç—Ä—ã —Ç–µ–ø–µ—Ä—å —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ! üöÄ**

