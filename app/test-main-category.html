<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç –±–ª–æ–∫–∞ –û—Å–Ω–æ–≤–Ω–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è —Ç–æ–≤–∞—Ä–æ–≤</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ccc; border-radius: 5px; }
        .error { color: red; }
        .success { color: green; }
        select { width: 300px; padding: 5px; margin: 5px 0; }
        button { padding: 10px 20px; margin: 5px; background: #007bff; color: white; border: none; border-radius: 3px; cursor: pointer; }
        button:hover { background: #0056b3; }
        .result { margin: 10px 0; padding: 10px; background: #f8f9fa; border-radius: 3px; }
    </style>
</head>
<body>
    <h1>üß™ –¢–µ—Å—Ç –±–ª–æ–∫–∞ "–û—Å–Ω–æ–≤–Ω–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è —Ç–æ–≤–∞—Ä–æ–≤"</h1>
    
    <div class="test-section">
        <h2>1. –¢–µ—Å—Ç –∑–∞–≥—Ä—É–∑–∫–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–π</h2>
        <button onclick="loadCategories()">–ó–∞–≥—Ä—É–∑–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</button>
        <div id="categoriesResult" class="result"></div>
    </div>

    <div class="test-section">
        <h2>2. –¢–µ—Å—Ç MainCategorySelector</h2>
        <select id="categorySelect">
            <option value="">–ó–∞–≥—Ä—É–∑–∫–∞...</option>
        </select>
        <div id="selectorResult" class="result"></div>
    </div>

    <div class="test-section">
        <h2>3. –¢–µ—Å—Ç –Ω–∞—Å—Ç—Ä–æ–µ–∫ –±–ª–æ–∫–∞</h2>
        <button onclick="testBlockSettings()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</button>
        <div id="settingsResult" class="result"></div>
    </div>

    <script>
        let categories = [];

        async function loadCategories() {
            const resultDiv = document.getElementById('categoriesResult');
            resultDiv.innerHTML = '–ó–∞–≥—Ä—É–∑–∫–∞...';
            
            try {
                const response = await fetch('/api/catalog/categories');
                const data = await response.json();
                
                if (data.categories) {
                    categories = data.categories;
                    resultDiv.innerHTML = `<div class="success">‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω–æ ${categories.length} –∫–∞—Ç–µ–≥–æ—Ä–∏–π</div>`;
                    resultDiv.innerHTML += '<pre>' + JSON.stringify(categories.slice(0, 3), null, 2) + '</pre>';
                    
                    // –ó–∞–ø–æ–ª–Ω—è–µ–º —Å–µ–ª–µ–∫—Ç
                    updateCategorySelect();
                } else {
                    resultDiv.innerHTML = '<div class="error">‚ùå –ù–µ—Ç –∫–∞—Ç–µ–≥–æ—Ä–∏–π –≤ –æ—Ç–≤–µ—Ç–µ</div>';
                }
            } catch (error) {
                resultDiv.innerHTML = `<div class="error">‚ùå –û—à–∏–±–∫–∞: ${error.message}</div>`;
            }
        }

        function updateCategorySelect() {
            const select = document.getElementById('categorySelect');
            select.innerHTML = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é</option>';
            
            categories.forEach(category => {
                const option = document.createElement('option');
                option.value = category.id;
                option.textContent = `${category.name} (${category.products_count || 0} —Ç–æ–≤–∞—Ä–æ–≤)`;
                select.appendChild(option);
            });
        }

        function testBlockSettings() {
            const resultDiv = document.getElementById('settingsResult');
            const selectedCategoryId = document.getElementById('categorySelect').value;
            
            if (!selectedCategoryId) {
                resultDiv.innerHTML = '<div class="error">‚ùå –°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é</div>';
                return;
            }

            const selectedCategory = categories.find(c => c.id === selectedCategoryId);
            
            resultDiv.innerHTML = `
                <div class="success">‚úÖ –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –±–ª–æ–∫–∞ –¥–ª—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ "${selectedCategory.name}"</div>
                <div><strong>ID:</strong> ${selectedCategory.id}</div>
                <div><strong>–£—Ä–æ–≤–µ–Ω—å:</strong> ${selectedCategory.level}</div>
                <div><strong>–¢–æ–≤–∞—Ä–æ–≤:</strong> ${selectedCategory.products_count || 0}</div>
                <div><strong>–ü—É—Ç—å:</strong> ${selectedCategory.path}</div>
                <div><strong>–ê–∫—Ç–∏–≤–Ω–∞:</strong> ${selectedCategory.is_active ? '–î–∞' : '–ù–µ—Ç'}</div>
            `;
        }

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–≥—Ä—É–∂–∞–µ–º –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        window.onload = loadCategories;
    </script>
</body>
</html>



